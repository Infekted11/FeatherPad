<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FeatherPad</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-green: #00a859;
            --dark-green: #007a41;
            --light-cream: #fff9f0;
            --text-white: #ffffff;
            --radius-lg: 20px;
            --radius-md: 12px;
            --overlay: rgba(0,0,0,0.4);
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Theme Definitions */
        body.theme-blue { --primary-green: #0072bc; --dark-green: #004a80; }
        body.theme-red { --primary-green: #bc2a00; --dark-green: #801d00; }
        body.theme-purple { --primary-green: #6a00bc; --dark-green: #480080; }
        body.theme-orange { --primary-green: #f39c12; --dark-green: #d35400; }
        body.theme-pink { --primary-green: #e91e63; --dark-green: #c2185b; }
        body.theme-teal { --primary-green: #009688; --dark-green: #00796b; }
        body.theme-indigo { --primary-green: #3f51b5; --dark-green: #303f9f; }
        body.theme-brown { --primary-green: #795548; --dark-green: #5d4037; }
        body.theme-slate { --primary-green: #607d8b; --dark-green: #455a64; }
        body.theme-cyan { --primary-green: #00bcd4; --dark-green: #0097a7; }
        body.theme-lime { --primary-green: #8bc34a; --dark-green: #689f38; }
        body.theme-amber { --primary-green: #ffc107; --dark-green: #ffa000; }
        body.theme-deep-purple { --primary-green: #673ab7; --dark-green: #512da8; }
        body.theme-forest { --primary-green: #2d5a27; --dark-green: #1a3a17; }
        body.theme-ocean { --primary-green: #1e88e5; --dark-green: #1565c0; }
        body.theme-sunset { --primary-green: #ff5722; --dark-green: #e64a19; }
        body.theme-midnight { --primary-green: #2c3e50; --dark-green: #1a252f; }
        body.theme-lavender { --primary-green: #9b59b6; --dark-green: #8e44ad; }
        body.theme-mint { --primary-green: #1abc9c; --dark-green: #16a085; }
        body.theme-rose { --primary-green: #ff4081; --dark-green: #f50057; }

        * { box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; }

        /* Themed scrollbars */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--primary-green) var(--light-cream);
        }
        *::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        *::-webkit-scrollbar-track {
            background: var(--light-cream);
            border-radius: 999px;
        }
        *::-webkit-scrollbar-thumb {
            background: var(--primary-green);
            border-radius: 999px;
            border: 2px solid var(--light-cream);
        }
        *::-webkit-scrollbar-thumb:hover {
            background: var(--dark-green);
        }

        body {
            background-color: var(--primary-green);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.5s ease;
        }

        #app-container {
            width: 95vw;
            height: 92vh;
            background-color: var(--light-cream);
            border: 6px solid var(--primary-green);
            border-radius: 30px;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 12px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            transition: border-color 0.5s ease;
            overflow: hidden;
        }

        .nav-tabs {
            display: flex;
            background-color: var(--primary-green);
            padding: 5px;
            border-radius: var(--radius-lg);
            margin-bottom: 12px;
            position: relative;
            z-index: 10;
            transition: background-color 0.5s ease, opacity 0.3s ease;
        }

        .tab-indicator {
            position: absolute;
            top: 5px;
            left: 5px;
            height: calc(100% - 10px);
            width: calc(33.33% - 6.66px);
            background-color: var(--dark-green);
            border-radius: var(--radius-lg);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), background-color 0.5s ease;
            z-index: 1;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        body.reduce-motion .view-track,
        body.reduce-motion .tab-indicator {
            transition: none;
        }

        .switch {
            position: relative;
            width: 78px;
            height: 34px;
            background: #d9d6cf;
            border-radius: 999px;
            border: 2px solid var(--primary-green);
            cursor: pointer;
            transition: background 0.25s ease, border-color 0.25s ease;
            display: inline-flex;
            align-items: center;
            padding: 2px;
        }
        .switch::after {
            content: "";
            width: 30px;
            height: 30px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            transform: translateX(0);
            transition: transform 0.25s ease;
        }
        .switch.active {
            background: var(--primary-green);
        }
        .switch.active::after {
            transform: translateX(40px);
        }

        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            color: var(--text-white);
            font-weight: 800;
            font-size: 0.9rem;
            text-transform: uppercase;
            cursor: pointer;
            user-select: none;
            z-index: 2;
            transition: opacity 0.3s;
        }
        
        .view-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .view-track {
            display: flex;
            width: 100%;
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .view-pane {
            flex: 0 0 100%;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 4px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px;
        }

        .doc-card {
            background-color: var(--primary-green);
            color: white;
            padding: 15px;
            border-radius: var(--radius-md);
            height: 140px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: var(--transition);
            position: relative;
        }
        .doc-card:hover { transform: translateY(-5px); background-color: var(--dark-green); }

        .fav-toggle {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.8);
            background: transparent;
            color: rgba(255,255,255,0.9);
            font-weight: 900;
            cursor: pointer;
            display: grid;
            place-items: center;
            transition: transform 0.2s ease, background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
            font-size: 18px;
        }
        .fav-toggle.active {
            background: #ffd54f;
            color: #4a3a00;
            border-color: #ffd54f;
        }
        body.theme-sunset .fav-toggle.active,
        body.theme-amber .fav-toggle.active {
            background: #1e88e5;
            border-color: #1e88e5;
            color: #ffffff;
        }
        .fav-toggle:hover { transform: scale(1.08); }

        .delete-toggle {
            position: absolute;
            bottom: 8px;
            left: 8px;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.8);
            background: transparent;
            color: rgba(255,255,255,0.9);
            font-weight: 900;
            cursor: pointer;
            display: grid;
            place-items: center;
            transition: transform 0.2s ease, background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        .delete-toggle:hover { transform: scale(1.08); background: rgba(255,255,255,0.15); }

        .doc-tags {
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            opacity: 0.85;
        }

        .doc-card.selected {
            transform: scale(1.06);
            z-index: 2;
        }

        .search-row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 10px;
        }

        .tag-filter-wrap {
            position: relative;
        }

        .tag-popup {
            position: absolute;
            top: 46px;
            right: 0;
            width: 240px;
            background: var(--light-cream);
            border: 2px solid var(--primary-green);
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            display: none;
            z-index: 20;
        }

        .tag-popup.active { display: block; }

        .tag-option {
            padding: 6px 8px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            color: #444;
        }
        .tag-option:hover { background: rgba(0,0,0,0.06); }
        .tag-option.active { background: var(--primary-green); color: #fff; }

        .search-star {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 2px solid var(--primary-green);
            background: var(--light-cream);
            color: var(--primary-green);
            font-weight: 900;
            cursor: pointer;
            display: grid;
            place-items: center;
            transition: transform 0.2s ease, background 0.2s ease, color 0.2s ease;
            font-size: 20px;
        }

        .material-icons {
            font-size: inherit;
            line-height: 1;
        }

        .search-star.active {
            background: var(--primary-green);
            color: var(--text-white);
        }

        .add-card {
            border: 3px dashed var(--primary-green);
            color: var(--primary-green);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            border-radius: var(--radius-md);
            height: 140px;
            cursor: pointer;
        }

        .theme-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            margin-top: 15px;
        }

        .theme-swatch {
            width: 120px;
            height: 120px;
            border-radius: var(--radius-md);
            cursor: pointer;
            border: 4px solid var(--light-cream);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding-left: 0;
        }

        .theme-swatch span {
            color: white;
            font-size: clamp(0.7rem, 1.2vw, 0.9rem);
            font-weight: 900;
            text-transform: uppercase;
            opacity: 1;
            white-space: nowrap;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-left: 0;
            transition: opacity 0.2s ease;
            text-shadow: 0 1px 4px rgba(0,0,0,0.3);
        }

        .theme-swatch:hover span {
            opacity: 1;
        }

        .theme-swatch.active {
            border-color: var(--light-cream);
            transform: scale(1.08);
        }

        .theme-swatch:hover {
            transform: scale(1.08);
        }

        /* Full Screen Editor View */
        #editor-view {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--light-cream);
            z-index: 50;
            display: none;
            flex-direction: column;
            padding: 12px;
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1), transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            min-height: 0;
        }
        #editor-view.active { 
            display: flex; 
            opacity: 1; 
            transform: translateY(0); 
        }

        .toolbar {
            display: flex; gap: 6px; margin-bottom: 8px; padding: 8px;
            background: rgba(0,0,0,0.06); border-radius: 12px;
            flex-wrap: wrap; align-items: center;
        }

        .custom-select {
            appearance: none; background-color: var(--primary-green); color: white;
            border: none; padding: 8px 30px 8px 12px; border-radius: 8px;
            font-size: 0.8rem; font-weight: bold; cursor: pointer; outline: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 8px center;
            background-size: 16px; transition: var(--transition);
        }

        .btn {
            padding: 8px 12px; background: var(--primary-green); color: white;
            border: none; border-radius: 8px; cursor: pointer;
            font-weight: bold; font-size: 0.8rem; transition: var(--transition);
        }
        .btn.danger { background: #d32f2f; }
        body.theme-red .btn.danger,
        body.theme-pink .btn.danger,
        body.theme-rose .btn.danger,
        body.theme-sunset .btn.danger {
            background: #ffce1b;
            color: #ffffff;
        }
        .shortcut-block {
            background: #ffffff;
            border: 2px solid rgba(0,0,0,0.06);
            border-radius: 20px;
            padding: 18px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
        }
        .shortcut-grid {
            display: grid;
            gap: 10px;
            font-size: 0.85rem;
            color: #333;
            font-weight: 700;
        }
        .shortcut-row {
            display: grid;
            grid-template-columns: 90px 1fr;
            gap: 10px;
            align-items: start;
        }
        .shortcut-title {
            color: var(--primary-green);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.7rem;
        }
        .shortcut-keys kbd {
            display: inline-block;
            padding: 3px 7px;
            border-radius: 6px;
            border: 1px solid rgba(0,0,0,0.15);
            background: #f8f6f2;
            font-weight: 900;
            font-size: 0.75rem;
            margin-right: 6px;
        }
        .btn.secondary { background: #666; }

        #save-status {
            font-size: 0.75rem;
            color: var(--primary-green);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 8px;
            min-width: 50px;
            text-align: right;
            transition: opacity 0.2s;
        }

        .editor-shell {
            flex: 1 1 0;
            display: flex;
            gap: 12px;
            min-height: 0;
            height: 0;
        }

        .editor-surface {
            flex: 1;
            background: var(--light-cream);
            border: 2px solid var(--primary-green);
            border-radius: 12px;
            padding: 15px;
            overflow-y: auto;
            outline: none;
            font-size: 0.95rem;
            line-height: 1.5;
            min-height: 0;
            height: 100%;
        }

        #rich-editor-input {
            display: block;
            resize: none;
            width: 100%;
            border: 2px solid var(--primary-green);
            font-family: "Courier New", Courier, monospace;
            color: #1d1d1d;
            background: #fffef9;
            overflow-y: auto;
        }

        #rich-editor-preview {
            cursor: text;
            background: #fffdf6;
        }

        .editor-resizer {
            width: 10px;
            cursor: col-resize;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.08), transparent);
            border-radius: 999px;
            align-self: stretch;
            flex: 0 0 10px;
        }

        .editor-resizer:active {
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.16), transparent);
        }


        #rich-editor-preview h1 { font-size: 1.6rem; margin-bottom: 0.6rem; }
        #rich-editor-preview h2 { font-size: 1.3rem; margin-bottom: 0.5rem; }
        #rich-editor-preview p { margin: 0 0 0.75rem 0; }
        #rich-editor-preview ul, #rich-editor-preview ol { margin: 0 0 0.75rem 1.2rem; }
        #rich-editor-preview li { margin-bottom: 0.3rem; }

        .footer-logo { 
            position: absolute; bottom: 12px; right: 20px; 
            color: var(--primary-green); font-weight: 900; 
            font-size: 45px; opacity: 0.15; pointer-events: none; 
        }

        /* Modal Smoother Transitions */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--overlay); 
            display: flex;
            justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(2px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        .modal {
            background: var(--light-cream); padding: 24px; border-radius: 25px;
            width: 320px; text-align: center; border: 5px solid var(--primary-green);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            transform: scale(0.85) translateY(10px);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }
    </style>
</head>
<body>

<div id="app-container">
    <div class="nav-tabs" id="main-tabs">
        <div class="tab-indicator" id="indicator"></div>
        <div class="tab" onclick="jumpToView(0)">Files</div>
        <div class="tab" onclick="jumpToView(1)">Options</div>
        <div class="tab" onclick="jumpToView(2)">Credits</div>
    </div>

    <div class="view-content">
        <div class="view-track" id="view-track">
        <!-- View 0: Files -->
        <div id="view-0" class="view-pane active">
            <div class="search-row">
                <input type="text" id="file-search" placeholder="Search by title or content..." style="flex:1; background: var(--light-cream); border:2px solid var(--primary-green); padding:10px; border-radius:12px; font-weight:600; outline:none;" oninput="renderFiles()">
                <div class="tag-filter-wrap">
                    <button id="tag-filter-btn" class="search-star" onclick="toggleTagPopup()" title="Filter by tag">#</button>
                    <div id="tag-popup" class="tag-popup">
                        <input type="text" id="tag-search" placeholder="Search tags..." style="width:100%; background: var(--light-cream); border:2px solid var(--primary-green); padding:6px; border-radius:10px; font-weight:600; outline:none; margin-bottom:8px;" oninput="renderTagOptions()">
                        <div id="tag-options"></div>
                    </div>
                </div>
                <button id="favorites-only" class="search-star" onclick="toggleFavoritesFilter()" title="Show favorites only"><span class="material-icons">star</span></button>
                <button id="selection-mode-toggle" class="search-star" onclick="toggleSelectionMode()" title="Selection mode"><span class="material-icons">check</span></button>
            </div>
            <div id="bulk-actions" style="display:none; margin-bottom:10px; gap:8px;" class="toolbar">
                <button class="btn" onclick="bulkToggleFavorite()">Toggle Favorite</button>
                <button class="btn danger" onclick="bulkDelete()">Delete</button>
                <button class="btn" style="background:#555" onclick="bulkDownload()">Download</button>
            </div>
            <div class="grid-container" id="file-grid">
                <div class="add-card" onclick="showCreateModal()">+</div>
            </div>
        </div>

        <!-- View 1: Options -->
        <div id="view-1" class="view-pane" style="overflow-y:auto;">
            <div style="background: var(--light-cream); padding: 20px; border-radius: 20px; border: 2px solid var(--primary-green);">
                <label style="color: var(--primary-green); font-weight: 900; display: block; margin-bottom: 5px;">Color Themes</label>
                <p style="font-size: 0.75rem; color: #666; margin-bottom: 8px;">Hover a theme to preview it. Click to select.</p>
                
                <div class="theme-grid" id="theme-selector">
                    <!-- Themes generated by JS -->
                </div>
            </div>
            <div class="shortcut-block" style="margin-top: 15px;">
                <label style="color: var(--primary-green); font-weight: 900; display: block; margin-bottom: 10px;">Keyboard Shortcuts</label>
                <div class="shortcut-grid">
                    <div class="shortcut-row">
                        <div class="shortcut-title">Files Tab</div>
                        <div class="shortcut-keys">
                            <kbd>n</kbd>new file
                            <kbd>i</kbd>import
                            <kbd>/</kbd>search
                            <kbd>t</kbd>tag search
                            <kbd>s</kbd>selection
                        </div>
                    </div>
                    <div class="shortcut-row">
                        <div class="shortcut-title">Editor</div>
                        <div class="shortcut-keys">
                            <kbd>Esc</kbd>close
                            <kbd>Hold Esc</kbd>3s delete
                        </div>
                    </div>
                    <div class="shortcut-row">
                        <div class="shortcut-title">Options</div>
                        <div class="shortcut-keys">
                            <kbd>r</kbd>set Emerald
                            <kbd>Hold r</kbd>10s reset
                        </div>
                    </div>
                </div>
            </div>
            <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top: 15px; background: var(--light-cream); border: 2px solid var(--primary-green); padding: 12px; border-radius: 14px; font-weight: 800; color:#444;">
                <span>Reduce Motion by Disabling Sliding Effect</span>
                <button id="reduce-motion-toggle" class="switch" onclick="toggleReduceMotion()" aria-label="Reduce Motion"></button>
            </div>
            <div style="width:100%; margin-top: 15px; padding: 15px; border-radius: 15px; background:#d32f2f; color:#fff; font-weight:900; text-align:center;">
                To reset hold "<span style="white-space:nowrap;">R</span>" for 10 seconds
            </div>
        </div>

        <!-- View 2: Credits -->
        <div id="view-2" class="view-pane">
            <div style="background: var(--light-cream); padding: 40px; border-radius: 20px; border: 2px solid var(--primary-green); text-align: center;">
                <h2 style="color: var(--primary-green); font-weight: 900;">FeatherPad</h2>
                <p style="margin: 15px 0; color: #666; font-size: 0.9rem;">A lightweight markdown editor.</p>
                <div style="margin-top: 30px; border-top: 2px solid rgba(0,0,0,0.05); padding-top: 20px; font-weight: bold; color: var(--primary-green);">Made by Infekted11</div>
            </div>
        </div>
        </div>
    </div>

    <!-- Full Screen Editor -->
    <div id="editor-view">
        <div class="editor-header" style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
            <div style="flex: 1;">
                <input type="text" id="file-title" style="width:100%; background: var(--light-cream); border:2px solid var(--primary-green); padding:8px; border-radius:10px; font-weight:bold; outline:none;" oninput="autoSave()">
            </div>
            <div style="flex: 1;">
                <input type="text" id="file-tags" placeholder="Tags (comma separated)" style="width:100%; background: var(--light-cream); border:2px solid var(--primary-green); padding:8px; border-radius:10px; font-weight:bold; outline:none;" oninput="autoSave()">
            </div>
            <button class="btn danger" onclick="showDeleteModalFor([currentFileId])">Delete</button>
            <button class="btn" onclick="closeEditor()">Back</button>
        </div>
        <div class="toolbar editor-interactive">
            <div style="display:flex; gap:12px; align-items:center; font-weight:800; color:#444;">
                <span id="word-count">0 words</span>
                <span id="sentence-count">0 sentences</span>
                <span id="char-count">0 characters</span>
            </div>
            <div style="flex:1"></div>
            <div id="save-status">Saved</div>
            <button class="btn" style="background:#555" onclick="downloadFile()">Export</button>
        </div>
        <div class="editor-shell">
            <textarea id="rich-editor-input" class="editor-surface" style="flex:1" oninput="handleLiveInput()" onblur="handleEditorBlur()"></textarea>
            <div id="editor-resizer" class="editor-resizer" title="Drag to resize"></div>
            <div id="rich-editor-preview" class="editor-surface" style="flex:1" tabindex="0"></div>
        </div>
    </div>

    <div class="footer-logo">FeatherPad</div>
</div>

<div id="hold-indicator" style="position:fixed; bottom:18px; left:18px; background:rgba(0,0,0,0.75); color:#fff; padding:8px 12px; border-radius:10px; font-weight:800; font-size:0.75rem; display:none; z-index:2000;">
    <span id="hold-label"></span>
    <span id="hold-countdown" style="margin-left:8px;"></span>
</div>

<div id="create-modal" class="modal-overlay">
    <div class="modal">
        <h3>New Document</h3>
        <button class="btn" style="width:100%; margin: 10px 0; padding: 12px;" onclick="createNewFile()">Blank Document</button>
        <button class="btn secondary" style="width:100%; margin-bottom: 10px; padding: 12px;" onclick="triggerImport()">Import .md File</button>
        <p id="import-error" style="color:red; font-size:0.75rem; margin-bottom:10px; display:none; font-weight:bold;">Only .md files allowed!</p>
        <button class="btn" style="background:none; color:#999;" onclick="hideCreateModal()">Cancel</button>
    </div>
</div>

<div id="delete-modal" class="modal-overlay">
    <div class="modal">
        <h3>Delete File?</h3>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn secondary" style="flex:1" onclick="hideDeleteModal()">Cancel</button>
            <button class="btn danger" style="flex:1" onclick="confirmDeleteTargets()">Delete</button>
        </div>
    </div>
</div>

<input type="file" id="file-import" style="display:none" accept=".md">

<script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-task-lists@2.1.1/dist/markdown-it-task-lists.min.js"></script>
<script>
    let files = JSON.parse(localStorage.getItem('md_editor_files')) || [];
    let currentFileId = null;
    let currentTheme = localStorage.getItem('md_editor_theme') || '';
    let saveTimeout;
    let isEditing = false;
    let currentMarkdown = '';
    let selectionMode = false;
    let selectedIds = new Set();
    let deleteTargets = [];
    let reduceMotion = localStorage.getItem('reduce_motion') === '1';
    let holdInterval = null;

    const themes = [
        { name: 'Emerald', class: '', color: '#00a859' },
        { name: 'Ocean', class: 'theme-ocean', color: '#1e88e5' },
        { name: 'Sunset', class: 'theme-sunset', color: '#ff5722' },
        { name: 'Midnight', class: 'theme-midnight', color: '#2c3e50' },
        { name: 'Lavender', class: 'theme-lavender', color: '#9b59b6' },
        { name: 'Rose', class: 'theme-rose', color: '#ff4081' },
        { name: 'Mint', class: 'theme-mint', color: '#1abc9c' },
        { name: 'Cobalt', class: 'theme-blue', color: '#0072bc' },
        { name: 'Crimson', class: 'theme-red', color: '#bc2a00' },
        { name: 'Violet', class: 'theme-purple', color: '#6a00bc' },
        { name: 'Amber', class: 'theme-orange', color: '#f39c12' },
        { name: 'Flamingo', class: 'theme-pink', color: '#e91e63' },
        { name: 'Teal', class: 'theme-teal', color: '#009688' },
        { name: 'Indigo', class: 'theme-indigo', color: '#3f51b5' },
        { name: 'Cocoa', class: 'theme-brown', color: '#795548' },
        { name: 'Slate', class: 'theme-slate', color: '#607d8b' },
        { name: 'Cyan', class: 'theme-cyan', color: '#00bcd4' },
        { name: 'Lime', class: 'theme-lime', color: '#8bc34a' },
        { name: 'Sunflower', class: 'theme-amber', color: '#ffc107' },
        { name: 'Amethyst', class: 'theme-deep-purple', color: '#673ab7' }
    ];
    
    function jumpToView(index) {
        const indicator = document.getElementById('indicator');
        indicator.style.transform = `translateX(${index * 100}%)`;
        const track = document.getElementById('view-track');
        if (track) track.style.transform = `translateX(-${index * 100}%)`;
        document.querySelectorAll('.view-pane').forEach((pane, i) => {
            pane.classList.toggle('active', i === index);
        });
        const footer = document.querySelector('.footer-logo');
        if (footer) footer.style.display = index === 1 ? 'none' : 'block';
        if(index === 0) renderFiles();
        if(index === 1) renderThemeSelector();
    }

    function renderFiles() {
        const grid = document.getElementById('file-grid');
        const query = (document.getElementById('file-search')?.value || '').trim().toLowerCase();
        const favoritesOnly = document.getElementById('favorites-only')?.classList.contains('active');
        const tagFilter = (document.getElementById('tag-filter-btn')?.dataset.tag || '').toLowerCase();
        grid.innerHTML = '';
        const sorted = [...files].sort((a, b) => (b.updatedAt || 0) - (a.updatedAt || 0));
        sorted.forEach(file => {
            if (favoritesOnly && !file.favorite) {
                return;
            }
            if (tagFilter) {
                const tags = (file.tags || []).map(t => t.toLowerCase());
                if (!tags.includes(tagFilter)) return;
            }
            if (query) {
                const hayTitle = (file.title || '').toLowerCase();
                const hayContent = plainTextFromMarkdown(file.content || '').toLowerCase();
                if (!fuzzyMatch(hayTitle, query) && !fuzzyMatch(hayContent, query)) {
                    return;
                }
            }
            const card = document.createElement('div');
            card.className = `doc-card ${selectedIds.has(file.id) ? 'selected' : ''}`;
            card.onclick = (e) => {
                if (selectionMode) {
                    toggleSelection(file.id);
                    return;
                }
                openFile(file.id);
            };
            const tagsText = (file.tags || []).join(', ');
            card.innerHTML = `<div><div class="title">${file.title || 'Untitled'}</div>${tagsText ? `<div class="doc-tags">${tagsText}</div>` : ''}</div>`;

            const favBtn = document.createElement('button');
            favBtn.className = `fav-toggle ${file.favorite ? 'active' : ''}`;
            favBtn.title = file.favorite ? 'Unfavorite' : 'Favorite';
            favBtn.innerHTML = `<span class="material-icons">${file.favorite ? 'star' : 'star_border'}</span>`;
            favBtn.onclick = (e) => {
                e.stopPropagation();
                file.favorite = !file.favorite;
                file.updatedAt = Date.now();
                saveData();
                renderFiles();
            };
            card.appendChild(favBtn);

            const delBtn = document.createElement('button');
            delBtn.className = 'delete-toggle';
            delBtn.title = 'Delete';
            delBtn.textContent = 'Ã—';
            delBtn.onclick = (e) => {
                e.stopPropagation();
                showDeleteModalFor([file.id]);
            };
            card.appendChild(delBtn);
            grid.appendChild(card);
        });
        const addCard = document.createElement('div');
        addCard.className = 'add-card';
        addCard.onclick = () => showCreateModal();
        addCard.textContent = '+';
        grid.appendChild(addCard);
        renderTagOptions();
        const favFilterBtn = document.getElementById('favorites-only');
        if (favFilterBtn) {
            favFilterBtn.innerHTML = `<span class="material-icons">${favFilterBtn.classList.contains('active') ? 'star' : 'star_border'}</span>`;
        }
    }

    function renderThemeSelector() {
        const selector = document.getElementById('theme-selector');
        selector.innerHTML = '';
        themes.forEach(theme => {
            const swatch = document.createElement('div');
            swatch.className = `theme-swatch ${currentTheme === theme.class ? 'active' : ''}`;
            swatch.style.backgroundColor = theme.color;
            swatch.innerHTML = `<span>${theme.name}</span>`;
            swatch.onclick = () => setTheme(theme.class);
            swatch.onmouseenter = () => previewTheme(theme.class);
            swatch.onmouseleave = () => previewTheme(null);
            selector.appendChild(swatch);
        });
    }

    function openFile(id) {
        currentFileId = id;
        const file = files.find(f => f.id === id);
        if (!file) return;
        document.getElementById('file-title').value = file.title;
        document.getElementById('file-tags').value = (file.tags || []).join(', ');
        currentMarkdown = file.content || '';
        const input = document.getElementById('rich-editor-input');
        input.value = currentMarkdown;
        renderPreview();
        isEditing = false;
        const editor = document.getElementById('editor-view');
        editor.style.display = 'flex';
        setTimeout(() => editor.classList.add('active'), 10);
        document.getElementById('save-status').innerText = "Saved";
    }

    function closeEditor() {
        document.getElementById('editor-view').classList.remove('active');
        setTimeout(() => document.getElementById('editor-view').style.display = 'none', 500);
        currentFileId = null;
        isEditing = false;
        renderFiles();
    }

    function autoSave() {
        document.getElementById('save-status').innerText = "...";
        document.getElementById('save-status').style.opacity = "0.5";
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(() => {
            const file = files.find(f => f.id === currentFileId);
            if(file) {
                file.title = document.getElementById('file-title').value;
                if (isEditing) {
                    currentMarkdown = document.getElementById('rich-editor-input').value;
                }
                file.content = currentMarkdown;
                file.tags = parseTags(document.getElementById('file-tags').value);
                file.updatedAt = Date.now();
                saveData();
                document.getElementById('save-status').innerText = "Saved";
                document.getElementById('save-status').style.opacity = "1";
            }
        }, 800);
        updateCounts();
    }

    function saveData() { localStorage.setItem('md_editor_files', JSON.stringify(files)); }

    function downloadFile() {
        const file = files.find(f => f.id === currentFileId);
        if (!file) return;
        const markdown = isEditing ? document.getElementById('rich-editor-input').value : currentMarkdown;
        const blob = new Blob([markdown], {type: 'text/markdown'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${file.title}.md`;
        a.click();
    }

    function triggerImport() { 
        document.getElementById('import-error').style.display = 'none';
        document.getElementById('file-import').click(); 
    }

    document.getElementById('file-import').onchange = (e) => {
        const file = e.target.files[0];
        if(!file) return;
        if(!file.name.toLowerCase().endsWith('.md')) {
            document.getElementById('import-error').style.display = 'block';
            e.target.value = '';
            return;
        }
        const reader = new FileReader();
        reader.onload = (ev) => {
            const id = Date.now().toString();
            files.push({ id, title: file.name.replace('.md',''), content: ev.target.result, tags: [], updatedAt: Date.now() });
            saveData();
            hideCreateModal();
            renderFiles();
            openFile(id);
            e.target.value = '';
        };
        reader.readAsText(file);
    };

    function showCreateModal() { 
        document.getElementById('import-error').style.display = 'none';
        document.getElementById('create-modal').classList.add('active'); 
    }
    function hideCreateModal() { document.getElementById('create-modal').classList.remove('active'); }
    function showDeleteModal() { document.getElementById('delete-modal').classList.add('active'); }
    function hideDeleteModal() { document.getElementById('delete-modal').classList.remove('active'); }

    function createNewFile() {
        const id = Date.now().toString();
        files.push({ id, title: 'Untitled Document', content: '', tags: [], updatedAt: Date.now() });
        saveData(); hideCreateModal(); openFile(id);
    }

    function deleteCurrentFile() {
        files = files.filter(f => f.id !== currentFileId);
        saveData(); hideDeleteModal(); closeEditor();
    }

    function confirmDeleteTargets() {
        if (!deleteTargets || deleteTargets.length === 0) return;
        if (deleteTargets.length === 1 && deleteTargets[0] === currentFileId) {
            deleteCurrentFile();
            deleteTargets = [];
            return;
        }
        files = files.filter(f => !deleteTargets.includes(f.id));
        saveData(); hideDeleteModal();
        if (deleteTargets.includes(currentFileId)) closeEditor();
        deleteTargets = [];
        renderFiles();
    }

    function handleEditorBlur() {
        setTimeout(() => {
            const active = document.activeElement;
            if (active && active.closest && (active.closest('.editor-shell') || active.closest('.editor-interactive'))) {
                return;
            }
            isEditing = false;
        }, 0);
    }

    function renderPreview() {
        const preview = document.getElementById('rich-editor-preview');
        preview.innerHTML = renderMarkdown(currentMarkdown || '');
        updateCounts();
    }

    const mdParser = window.markdownit
        ? window.markdownit({ html: false, linkify: true, breaks: true, typographer: true })
              .use(window.markdownitTaskLists, { enabled: true, label: true })
        : null;

    function renderMarkdown(md) {
        if (mdParser) {
            const rendered = mdParser.render(md || '');
            return rendered || "<p style='color:#888;'>Click to start writing...</p>";
        }
        return "<p style='color:#888;'>Markdown parser failed to load.</p>";
    }

    function updateCounts() {
        const text = (currentMarkdown || '')
            .replace(/\r?\n/g, ' ')
            .replace(/\s+/g, ' ')
            .trim();
        const words = text ? text.split(' ').length : 0;
        const sentences = text ? (text.match(/[^.!?]+[.!?]+/g) || []).length || (text ? 1 : 0) : 0;
        const chars = (currentMarkdown || '').length;
        document.getElementById('word-count').innerText = `${words} ${words === 1 ? 'word' : 'words'}`;
        document.getElementById('sentence-count').innerText = `${sentences} ${sentences === 1 ? 'sentence' : 'sentences'}`;
        document.getElementById('char-count').innerText = `${chars} ${chars === 1 ? 'character' : 'characters'}`;
    }

    function toggleFavoritesFilter() {
        const btn = document.getElementById('favorites-only');
        if (!btn) return;
        btn.classList.toggle('active');
        btn.innerHTML = `<span class="material-icons">${btn.classList.contains('active') ? 'star' : 'star_border'}</span>`;
        renderFiles();
    }

    function toggleSelectionMode() {
        selectionMode = !selectionMode;
        const btn = document.getElementById('selection-mode-toggle');
        if (btn) btn.classList.toggle('active', selectionMode);
        if (!selectionMode) selectedIds.clear();
        const bulk = document.getElementById('bulk-actions');
        if (bulk) bulk.style.display = selectionMode ? 'flex' : 'none';
        renderFiles();
    }

    function toggleSelection(id) {
        if (selectedIds.has(id)) selectedIds.delete(id);
        else selectedIds.add(id);
        renderFiles();
    }

    function bulkToggleFavorite() {
        if (selectedIds.size === 0) return;
        const allFav = [...selectedIds].every(id => (files.find(f => f.id === id)?.favorite));
        files.forEach(f => {
            if (selectedIds.has(f.id)) {
                f.favorite = !allFav;
                f.updatedAt = Date.now();
            }
        });
        saveData();
        renderFiles();
    }

    function bulkDelete() {
        if (selectedIds.size === 0) return;
        showDeleteModalFor([...selectedIds]);
    }

    function bulkDownload() {
        if (selectedIds.size === 0) return;
        const selected = files.filter(f => selectedIds.has(f.id));
        selected.forEach(file => {
            const blob = new Blob([file.content || ''], {type: 'text/markdown'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${file.title || 'Untitled'}.md`;
            a.click();
        });
    }

    function showDeleteModalFor(ids) {
        deleteTargets = ids;
        document.getElementById('delete-modal').classList.add('active');
    }

    function parseTags(raw) {
        return (raw || '')
            .split(',')
            .map(t => t.trim())
            .filter(Boolean);
    }

    function toggleTagPopup() {
        const popup = document.getElementById('tag-popup');
        if (!popup) return;
        popup.classList.toggle('active');
        if (popup.classList.contains('active')) {
            renderTagOptions();
            document.getElementById('tag-search')?.focus();
        }
    }

    function renderTagOptions() {
        const wrap = document.getElementById('tag-options');
        const search = (document.getElementById('tag-search')?.value || '').trim().toLowerCase();
        if (!wrap) return;
        const tags = new Set();
        files.forEach(f => (f.tags || []).forEach(t => tags.add(t)));
        const all = [...tags].sort((a, b) => a.localeCompare(b));
        const filtered = all.filter(t => !search || fuzzyMatch(t.toLowerCase(), search));
        wrap.innerHTML = '';

        const allOpt = document.createElement('div');
        allOpt.className = `tag-option ${!document.getElementById('tag-filter-btn')?.dataset.tag ? 'active' : ''}`;
        allOpt.textContent = 'All Tags';
        allOpt.onclick = () => setTagFilter('');
        wrap.appendChild(allOpt);

        filtered.forEach(tag => {
            const opt = document.createElement('div');
            opt.className = `tag-option ${document.getElementById('tag-filter-btn')?.dataset.tag === tag ? 'active' : ''}`;
            opt.textContent = tag;
            opt.onclick = () => setTagFilter(tag);
            wrap.appendChild(opt);
        });
    }

    function setTagFilter(tag) {
        const btn = document.getElementById('tag-filter-btn');
        if (!btn) return;
        if (tag) {
            btn.dataset.tag = tag;
            btn.classList.add('active');
        } else {
            delete btn.dataset.tag;
            btn.classList.remove('active');
        }
        renderFiles();
    }

    function fuzzyMatch(text, query) {
        if (!query) return true;
        let ti = 0;
        let qi = 0;
        while (ti < text.length && qi < query.length) {
            if (text[ti] === query[qi]) qi++;
            ti++;
        }
        return qi === query.length;
    }

    function plainTextFromMarkdown(md) {
        return (md || '')
            .replace(/```[\s\S]*?```/g, ' ')
            .replace(/`[^`]*`/g, ' ')
            .replace(/!\[[^\]]*\]\([^)]+\)/g, ' ')
            .replace(/\[[^\]]*\]\([^)]+\)/g, ' ')
            .replace(/[*_~>#=-]{1,}/g, ' ')
            .replace(/\|/g, ' ')
            .replace(/\s+/g, ' ')
            .trim();
    }

    function insertAroundSelection(prefix, suffix = prefix) {
        const input = document.getElementById('rich-editor-input');
        const start = input.selectionStart;
        const end = input.selectionEnd;
        const value = input.value;
        input.value = value.slice(0, start) + prefix + value.slice(start, end) + suffix + value.slice(end);
        input.selectionStart = start + prefix.length;
        input.selectionEnd = end + prefix.length;
        handleLiveInput();
    }

    function insertLinePrefix(prefix) {
        const input = document.getElementById('rich-editor-input');
        const pos = input.selectionStart;
        const value = input.value;
        const lineStart = value.lastIndexOf("\n", pos - 1) + 1;
        input.value = value.slice(0, lineStart) + prefix + value.slice(lineStart);
        input.selectionStart = pos + prefix.length;
        input.selectionEnd = pos + prefix.length;
        handleLiveInput();
    }

    function applyBlockStyle(type) {
        if (!type) return;
        const map = { P: "", H1: "# ", H2: "## " };
        if (map[type] !== undefined) {
            insertLinePrefix(map[type]);
        }
    }

    function handleLiveInput() {
        isEditing = true;
        currentMarkdown = document.getElementById('rich-editor-input').value;
        renderPreview();
        autoSave();
    }

    function setTheme(t) {
        const body = document.body;
        themes.forEach(theme => {
            if (theme.class) body.classList.remove(theme.class);
        });
        if (t) body.classList.add(t);
        currentTheme = t;
        localStorage.setItem('md_editor_theme', t);
        renderThemeSelector();
        applyReduceMotion();
    }

    function applyReduceMotion() {
        const toggle = document.getElementById('reduce-motion-toggle');
        if (toggle) toggle.classList.toggle('active', reduceMotion);
        document.body.classList.toggle('reduce-motion', reduceMotion);
    }

    function toggleReduceMotion() {
        reduceMotion = !reduceMotion;
        localStorage.setItem('reduce_motion', reduceMotion ? '1' : '0');
        applyReduceMotion();
    }

    function previewTheme(t) {
        if (t === null) {
            document.body.className = currentTheme;
            return;
        }
        document.body.className = t;
    }

    function clearAllData() {
        if(confirm("Wipe everything? This will delete all your notes.")) { localStorage.clear(); location.reload(); }
    }

    let escHoldTimer = null;
    let rHoldTimer = null;
    let holdStartTime = null;
    let holdDurationMs = null;
    let holdLabel = '';

    function showHoldIndicator(label, durationMs) {
        const box = document.getElementById('hold-indicator');
        const labelEl = document.getElementById('hold-label');
        const countdownEl = document.getElementById('hold-countdown');
        if (!box || !labelEl || !countdownEl) return;

        holdStartTime = Date.now();
        holdDurationMs = durationMs;
        holdLabel = label;
        box.style.display = 'block';
        labelEl.textContent = label;

        if (holdInterval) clearInterval(holdInterval);
        holdInterval = setInterval(() => {
            const elapsed = Date.now() - holdStartTime;
            const remaining = Math.max(0, holdDurationMs - elapsed);
            countdownEl.textContent = `${(remaining / 1000).toFixed(1)}s`;
            if (remaining <= 0) {
                hideHoldIndicator();
            }
        }, 100);
    }

    function hideHoldIndicator() {
        const box = document.getElementById('hold-indicator');
        if (box) box.style.display = 'none';
        if (holdInterval) {
            clearInterval(holdInterval);
            holdInterval = null;
        }
        holdStartTime = null;
        holdDurationMs = null;
        holdLabel = '';
    }

    function isTypingTarget(target) {
        if (!target) return false;
        const tag = target.tagName;
        return tag === 'INPUT' || tag === 'TEXTAREA' || target.isContentEditable;
    }

    function isEditorOpen() {
        return document.getElementById('editor-view')?.classList.contains('active');
    }

    function activeViewIndex() {
        const panes = document.querySelectorAll('.view-pane');
        for (let i = 0; i < panes.length; i++) {
            if (panes[i].classList.contains('active')) return i;
        }
        return 0;
    }

    document.addEventListener('keydown', (e) => {
        if (isTypingTarget(e.target)) return;

        const inEditor = isEditorOpen();
        const view = activeViewIndex();

        if (inEditor) {
            if (e.key === 'Escape') {
                e.preventDefault();
                if (!escHoldTimer) {
                    showHoldIndicator('Holding Esc: delete', 3000);
                    escHoldTimer = setTimeout(() => {
                        if (currentFileId) showDeleteModalFor([currentFileId]);
                        hideHoldIndicator();
                        escHoldTimer = null;
                    }, 3000);
                }
            }
            return;
        }

        if (view === 0) {
            if (e.key === 'n' || e.key === 'N') {
                e.preventDefault();
                createNewFile();
            } else if (e.key === 'i' || e.key === 'I') {
                e.preventDefault();
                triggerImport();
            } else if (e.key === '/') {
                e.preventDefault();
                document.getElementById('file-search')?.focus();
            } else if (e.key === 't' || e.key === 'T') {
                e.preventDefault();
                toggleTagPopup();
            } else if (e.key === 's' || e.key === 'S') {
                e.preventDefault();
                toggleSelectionMode();
            }
        } else if (view === 1) {
            if (e.key === 'r' || e.key === 'R') {
                e.preventDefault();
                if (!rHoldTimer) {
                    showHoldIndicator('Holding R: reset app', 10000);
                    rHoldTimer = setTimeout(() => {
                        clearAllData();
                        hideHoldIndicator();
                        rHoldTimer = null;
                    }, 10000);
                }
            }
        }
    });

    document.addEventListener('keyup', (e) => {
        const inEditor = isEditorOpen();
        const view = activeViewIndex();

        if (inEditor && e.key === 'Escape') {
            if (escHoldTimer) {
                clearTimeout(escHoldTimer);
                escHoldTimer = null;
                hideHoldIndicator();
                closeEditor();
            }
        }

        if (view === 1 && (e.key === 'r' || e.key === 'R')) {
            if (rHoldTimer) {
                clearTimeout(rHoldTimer);
                rHoldTimer = null;
                hideHoldIndicator();
                setTheme('');
            }
        }
    });

    function initEditorResizer() {
        const resizer = document.getElementById('editor-resizer');
        const input = document.getElementById('rich-editor-input');
        const preview = document.getElementById('rich-editor-preview');
        if (!resizer || !input || !preview) return;

        const savedRatio = parseFloat(localStorage.getItem('editor_split_ratio'));
        if (!Number.isNaN(savedRatio) && savedRatio > 0.25 && savedRatio < 0.75) {
            input.style.flex = `0 0 ${savedRatio * 100}%`;
            preview.style.flex = `1 1 ${(1 - savedRatio) * 100}%`;
        }

        let isDragging = false;
        const onMove = (e) => {
            if (!isDragging) return;
            const shell = resizer.parentElement;
            const rect = shell.getBoundingClientRect();
            const x = Math.min(Math.max(e.clientX - rect.left, rect.width * 0.25), rect.width * 0.75);
            const ratio = x / rect.width;
            input.style.flex = `0 0 ${ratio * 100}%`;
            preview.style.flex = `1 1 ${(1 - ratio) * 100}%`;
            localStorage.setItem('editor_split_ratio', ratio.toFixed(3));
        };
        const stopDrag = () => {
            if (!isDragging) return;
            isDragging = false;
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
            window.removeEventListener('mousemove', onMove);
            window.removeEventListener('mouseup', stopDrag);
        };

        resizer.addEventListener('mousedown', (e) => {
            e.preventDefault();
            isDragging = true;
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none';
            window.addEventListener('mousemove', onMove);
            window.addEventListener('mouseup', stopDrag);
        });
    }

    function ensureDefaultDocument() {
        if (files.length > 0) return;
        const id = Date.now().toString();
        const content = [
            "# Welcome to FeatherPad",
            "",
            "This starter note highlights the main features so you can jump right in.",
            "",
            "## Core Features",
            "- Live Markdown preview next to the editor.",
            "- Raw Markdown tags stay visible while you type.",
            "- Word, sentence, and character counters update in real time.",
            "- Drag the center divider to resize editor and preview.",
            "- Editor and preview are independently scrollable.",
            "- Add tags to organize notes and filter by tag.",
            "- Selection mode for bulk favorite, delete, and download.",
            "- Autosave keeps your work safe.",
            "- Export to `.md` anytime.",
            "- Import existing `.md` files from your device.",
            "- Color themes in the Options tab.",
            "",
            "## Quick Markdown Examples",
            "- **Bold** uses `**bold**`",
            "- *Italic* uses `*italic*`",
            "- Lists use `- item` or `1. item`",
            "- Headings use `#`, `##`, `###`",
            "",
            "Start editing this document or create a new one from the Files tab."
        ].join("\n");
        files.push({ id, title: "Getting Started", content, tags: ["welcome", "features"], updatedAt: Date.now() });
        saveData();
    }

    ensureDefaultDocument();
    setTheme(currentTheme);
    renderFiles();
    updateCounts();
    applyReduceMotion();
    initEditorResizer();
</script>
</body>
</html>
